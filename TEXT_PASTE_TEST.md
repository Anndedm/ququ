# 蛐蛐文本插入功能测试指南

## 功能概述

蛐蛐现在支持自动将语音转录结果插入到当前活跃的文本输入框中，参考了 OpenWhispr 的实现机制。

## 实现的功能

### 1. 自动文本插入
- ✅ 语音识别完成后自动粘贴到当前输入框
- ✅ 跨平台支持（macOS、Windows、Linux）
- ✅ 权限检查和用户引导（macOS）
- ✅ 自动恢复原剪贴板内容

### 2. 手动文本操作
- ✅ 复制识别文本到剪贴板
- ✅ 复制AI优化文本到剪贴板
- ✅ 手动粘贴AI优化文本
- ✅ 导出文本到文件

## 测试步骤

### 基础功能测试

1. **启动应用**
   ```bash
   cd chinese-whispr
   npm run dev
   ```

2. **准备测试环境**
   - 打开任意文本编辑器（如记事本、TextEdit、VS Code等）
   - 确保文本编辑器中有一个活跃的输入框

3. **测试自动粘贴**
   - 在蛐蛐中点击麦克风按钮开始录音
   - 说一段中文（如："今天天气很好，我想去公园散步"）
   - 停止录音，等待语音识别完成
   - **预期结果**：识别的文本应该自动出现在文本编辑器的输入框中

4. **测试AI优化文本粘贴**
   - 等待AI优化完成（绿色区域显示优化后的文本）
   - 点击AI优化文本区域的粘贴按钮（剪贴板图标）
   - **预期结果**：优化后的文本应该粘贴到当前输入框

### 权限测试（仅macOS）

1. **首次使用测试**
   - 如果是首次使用，系统会提示需要辅助功能权限
   - 应该会弹出权限设置对话框
   - 按照提示打开系统设置并授予权限

2. **权限被拒绝测试**
   - 如果权限被拒绝，文本应该只复制到剪贴板
   - 应该显示相应的提示信息

### 跨平台测试

#### macOS
- 使用 AppleScript 模拟 `Cmd+V`
- 需要辅助功能权限
- 支持权限检查和用户引导

#### Windows
- 使用 PowerShell 模拟 `Ctrl+V`
- 通过 SendKeys 发送按键

#### Linux
- 使用 xdotool 模拟 `Ctrl+V`
- 需要安装 xdotool 工具

## 错误处理测试

1. **网络环境测试**
   - 在浏览器中打开应用（非Electron环境）
   - **预期结果**：应该只复制到剪贴板，显示相应提示

2. **权限错误测试**
   - 在macOS上拒绝辅助功能权限
   - **预期结果**：显示权限设置指导，文本复制到剪贴板

3. **粘贴失败测试**
   - 在没有活跃输入框的情况下测试
   - **预期结果**：显示相应错误信息，文本已复制到剪贴板

## 验证要点

### 功能验证
- [ ] 语音识别完成后文本自动出现在目标输入框
- [ ] 原剪贴板内容在粘贴后被恢复
- [ ] AI优化文本可以手动粘贴
- [ ] 复制功能正常工作
- [ ] 导出功能正常工作

### 用户体验验证
- [ ] 粘贴操作有适当的用户反馈（toast提示）
- [ ] 权限问题有清晰的用户指导
- [ ] 错误情况有友好的错误提示
- [ ] 界面响应流畅，无明显卡顿

### 技术验证
- [ ] 不同应用程序中都能正常粘贴
- [ ] 中文字符正确处理
- [ ] 长文本正确处理
- [ ] 特殊字符和标点符号正确处理

## 已知限制

1. **macOS权限要求**
   - 需要用户手动授予辅助功能权限
   - 开发环境下可能需要重新授权

2. **Linux依赖**
   - 需要安装 xdotool 工具
   - 不同桌面环境可能有差异

3. **Web环境限制**
   - 浏览器环境下只能复制到剪贴板
   - 无法实现自动粘贴功能

## 故障排除

### macOS权限问题
```bash
# 检查权限状态
osascript -e 'tell application "System Events" to get name of first process'
```

### Linux工具安装
```bash
# Ubuntu/Debian
sudo apt-get install xdotool

# CentOS/RHEL
sudo yum install xdotool
```

### Windows PowerShell权限
确保PowerShell执行策略允许运行脚本：
```powershell
Get-ExecutionPolicy
Set-ExecutionPolicy RemoteSigned
```

## 成功标准

文本插入功能实现成功的标准：
1. ✅ 语音识别完成后文本自动出现在目标应用的输入框中
2. ✅ 支持主流操作系统（macOS、Windows、Linux）
3. ✅ 有完善的错误处理和用户提示
4. ✅ 原剪贴板内容得到保护和恢复
5. ✅ 用户可以选择粘贴AI优化后的文本
6. ✅ 在权限不足时有清晰的解决指导

---

**测试完成后，请在下方记录测试结果：**

- 测试日期：
- 测试平台：
- 测试结果：
- 发现的问题：
- 改进建议：